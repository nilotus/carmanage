<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../lib/layui/css/layui.css"  media="all">
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
 <div style="width: 400px;float: left;margin-left: 30px;">
	 	<div class="layui-card">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;" id="stationinfo1">		  
				</fieldset> 
				<ul class="layui-timeline" id="stationinfo2">
				</ul>
				<button type="button" class="layui-btn" style="margin-left: 5%;" onclick="funcadd()">添加停靠站</button>
				<button type="button" class="layui-btn" style="margin-left: 5%;" onclick="deletediv(this)">取消操作</button>
		</div>
		<div id="editst" style="display: none;">
			<form class="layui-form" action="">
				  <div class="layui-form-item">
				    <div class="layui-inline">
				      <label class="layui-form-label">停靠点</label>
				      <div class="layui-input-inline">
				        <input type="text" name="place" lay-verify="required" autocomplete="off" class="layui-input">
				      </div>
				    </div>
				    <div class="layui-inline">
				      <label class="layui-form-label">停靠时间</label>
				      <div class="layui-input-inline">
				        <input type="text" name="time" id="date" lay-verify="required" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
				      </div>
				    </div>
				</div>
				<div class="layui-form-item">
			    <div class="layui-input-block">
			      <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
			      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
			    </div>
			  </div>
  		</form>
		</div>
 </div>        
<script src="../lib/layui/layui.js" charset="utf-8"></script>
<script src="../lib/layui/js/jquery-3.3.1.min.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
	var ids=[];
	$.ajax({
		type:"post",
		url:"/station/ids",
		async:true,
		dataType: 'json',
		success:function(data){
			ids = data.data;
			console.log(ids);
		}
	});
	getRoute(6);
	var routeid ;
	function getRoute(id){
		routeid = id;
		$.ajax({
		type:"post",
		url:"/station/route/"+id,
		async:true,
		dataType: 'json',
		success:function(data){
			var str2 = "";
			var start = "<li class='layui-timeline-item'>"
			    +"<i class='layui-icon layui-timeline-axis'></i>"
			    +"<div class='layui-timeline-content layui-text'>";
			var start2 = "<li class='layui-timeline-item'>"
			    +"<i class='layui-icon layui-anim layui-anim-rotate layui-anim-loop layui-timeline-axis'></i>"
			    +"<div class='layui-timeline-content layui-text'>";
			var end = "</div></li>";
			var str1 = "<legend>"+data.data[0].carNumber+" "+data.data[0].name+"</legend>";
			var startplace= start+"<div class='layui-timeline-title'>"+ data.data[0].startTime + "从前有座灵剑山，山里有个舞师傅呀，还有她的弟子小王陆，话说有这么一天" +data.data[0].startPlace+"出发</div>"+end;
			for(var i=0;i<data.data.length-1;i++){
				str2+=start+"<div class='layui-timeline-title'>"+ data.data[i].time + "经过" +data.data[i].place+"</div>"+end;			    
			}
			var str3 = start2 +"<div class='layui-timeline-title'>"+ data.data[data.data.length-1].time + "经过" +data.data[data.data.length-1].place+"</div>"+end;
			$('#stationinfo1').append(str1);
			$('#stationinfo2').append(startplace+str2+str3);
		}
	});
	}
	function deletediv(o){
		var $parent = $(o).parent();
		$parent.remove();
}
	function addstation(id,place,time){
		var data = {
				"routeld":id,
		    "place":place,
		    "time":time,
			};
			ndata = JSON.stringify(data);
		$.ajax({
			type:"post",
			url:"/station/insert",
			async:true,
			dataType: 'json',
      contentType: 'application/json',
      data: ndata,
      success: function (data) {
        console.log(data);
	      if (data.code == 1) {
	        layer.msg(data.msg);
	      } else {
	        layer.msg(data.msg);
	      }
      },
      error: function () {
        alert("已存在");
      }
		});
	}
	function funcadd(){
  	layer.open({
			type: 1,
			title:"添加站点",
			skin: 'layui-layer-rim', //加上边框
			area: ['350px', '360px'], //宽高
			content:$('#editst').html()//调到新增页面
			});
  }
</script>
<script>
	layui.use(['form', 'laydate'], function(){
  var form = layui.form
  ,layer = layui.layer
  ,laydate = layui.laydate;
  
  //日期
  laydate.render({
    elem: '#date'
    ,type: 'datetime'
  });
  
  //监听提交
  form.on('submit(demo1)', function(data){
  		addstation(routeid,data.field.place,data.field.time);
  		return false;
    })
  
});
</script>
</body>
</html>